import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o,c,a as s,b as n,d as i,e as a}from"./app-8d307529.js";const l={},u=a('<h1 id="springsecurity6-é»˜è®¤ç”¨æˆ·ç”Ÿæˆ-ä¸‹" tabindex="-1"><a class="header-anchor" href="#springsecurity6-é»˜è®¤ç”¨æˆ·ç”Ÿæˆ-ä¸‹" aria-hidden="true">#</a> SpringSecurity6 | é»˜è®¤ç”¨æˆ·ç”Ÿæˆ(ä¸‹)</h1><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312070901718.png" alt="image-20231030235443828" tabindex="0" loading="lazy"><figcaption>image-20231030235443828</figcaption></figure><h2 id="_1-å‰è¨€" tabindex="-1"><a class="header-anchor" href="#_1-å‰è¨€" aria-hidden="true">#</a> 1.å‰è¨€</h2>',3),r={href:"https://gaoziman.blog.csdn.net/article/details/134816835",target:"_blank",rel:"noopener noreferrer"},k=a(`<p>å¥½äº†ï¼Œè¯ä¸å¤šè¯´è®©æˆ‘ä»¬å¼€å§‹å§ğŸ˜ğŸ˜ğŸ˜ã€‚</p><h2 id="_2-é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-é—®é¢˜" aria-hidden="true">#</a> 2.é—®é¢˜</h2><p>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæœ€åè®²åˆ°äº†UserDetailedServiceï¼Œç¨‹åºæœ€åä¹Ÿæ˜¯èµ°åˆ°äº†UserDetailedServiceçš„<strong>loadUserByUsername()<strong>æ–¹æ³•ï¼Œç„¶ååŸºäºå†…å­˜å¯¹æˆ‘ä»¬è¡¨å•è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œåˆ¤æ–­ï¼Œé‚£è¿™ä¸ª</strong>UserDetailedService</strong></p><p>ä»–æ˜¯å¦‚ä½•è¢«SpringBootåŠ è½½å‡ºæ¥çš„å‘¢ï¼Œæˆ‘ä»¬ä¸”å¬åç»­åˆ†äº«ã€‚</p><h2 id="_3-æ­æ™“" tabindex="-1"><a class="header-anchor" href="#_3-æ­æ™“" aria-hidden="true">#</a> 3.æ­æ™“</h2><h3 id="_3-1-userdetailserviceæ¥å£" tabindex="-1"><a class="header-anchor" href="#_3-1-userdetailserviceæ¥å£" aria-hidden="true">#</a> 3.1 UserDetailServiceæ¥å£</h3><p>åœ¨ UserDetailService æ¥å£ä¸­ï¼Œ<strong>loadUserByUserName()</strong> æ–¹æ³•ç”¨äºæ ¹æ®ç”¨æˆ·åè¿›è¡Œè®¤è¯ï¼Œé»˜è®¤åŸºäºå†…å­˜å®ç°ï¼Œä¸éœ€è¦æœ‰åç«¯æ•°æ®åº“çš„æ”¯æŒã€‚å¦‚æœæƒ³ä¿®æ”¹æˆæ•°æ®åº“å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰ UserDetailService æ¥å£çš„å®ç°ç±»ï¼Œå¹¶è¿”å› UserDetails å®ä¾‹å³å¯ï¼š</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312070913105.png" alt="image-20231207091353077" tabindex="0" loading="lazy"><figcaption>image-20231207091353077</figcaption></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹UserDetailServiceæ¥å£çš„ç»§æ‰¿ç»“æ„å›¾</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312070915468.png" alt="image-20231207091537435" tabindex="0" loading="lazy"><figcaption>image-20231207091537435</figcaption></figure><p><strong>CachingUserDetailsService</strong> (ä½äºorg.springframework.security.authenticationåŒ…ä¸‹)ç¼“å­˜ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ï¼Œæ˜¯UserDetailsService æ¥å£çš„å®ç°ä¹‹ä¸€ï¼Œè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„æºå¤´å¯ä»¥æ˜¯ä»ç¼“å­˜ä¸­è·å–,<br> è¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachingUserDetailsService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç”¨æˆ·ç¼“å­˜</span>
    <span class="token keyword">private</span> <span class="token class-name">UserCache</span> userCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NullUserCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–ç”¨æˆ·è¯¦æƒ…æœåŠ¡æ¥å£</span>
    <span class="token comment">// ä»¥å…ä»ç¼“å­˜ä¸­æ²¡æœ‰è·å–åˆ°ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token comment">// å¯ä»¥é€šè¿‡æä¾›çš„å…¶ä»–æ–¹å¼è·å–ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserDetailsService</span> delegate<span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ å™¨ åˆå§‹åŒ–è·å–ç”¨æˆ·ä¿¡æ¯çš„å…¶ä»–æœåŠ¡</span>
    <span class="token keyword">public</span> <span class="token class-name">CachingUserDetailsService</span><span class="token punctuation">(</span><span class="token class-name">UserDetailsService</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> delegate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     
    <span class="token comment">// è·å–ç”¨æˆ·ç¼“å­˜</span>
    <span class="token keyword">public</span> <span class="token class-name">UserCache</span> <span class="token function">getUserCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userCache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®¾ç½®ç”¨æˆ·ç¼“å­˜</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserCache</span><span class="token punctuation">(</span><span class="token class-name">UserCache</span> userCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userCache <span class="token operator">=</span> userCache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é€šè¿‡ç”¨æˆ·åç§°è·å–ç”¨æˆ·è¯¦æƒ…ä¿¡æ¯</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// ä»ç¼“å­˜ä¸­è·å–</span>
        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userCache<span class="token punctuation">.</span><span class="token function">getUserFromCache</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœä»ç¼“å­˜ä¸­è·å–çš„ç”¨æˆ·ä¿¡æ¯ä¸ºnull</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä½¿ç”¨å…¶ä»–æ–¹å¼è·å–ç”¨æˆ·ä¿¡æ¯</span>
            user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      
       <span class="token comment">// åˆ¤æ–­ç”¨æˆ·ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;UserDetailsService &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">+</span> <span class="token string">&quot; returned null for username &quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot;. This is an interface contract violation&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¸ä¸ºç©ºåˆ™å‘ç¼“å­˜ä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯</span>
        <span class="token comment">// ä¸‹æ¬¡å¯ä»¥ä»ç¼“å­˜ä¸­è·å–</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userCache<span class="token punctuation">.</span><span class="token function">putUserInCache</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿”å›ç”¨æˆ·ä¿¡æ¯</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>UserDetailsManager</strong>(ä½äºorg.springframework.security.provisioningåŒ…ä¸‹)ç”¨æˆ·è¯¦æƒ…ä¿¡æ¯ç®¡ç†ï¼Œè¿™ä¸ªæ¥å£ä¸ä»…ç»§æ‰¿äº†UserDetailsServiceæ¥å£æ‹¥æœ‰é€šè¿‡ç”¨æˆ·åè·å–ç”¨æˆ·è¯¦æƒ…ä¿¡æ¯çš„æ–¹æ³•ï¼Œè¿˜å®šä¹‰äº†è®¸å¤šæ“ä½œç”¨æˆ·çš„ç›¸å…³æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetailsManager</span> <span class="token keyword">extends</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºç”¨æˆ·</span>
    <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¿®æ”¹ç”¨æˆ·</span>
    <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// åˆ é™¤ç”¨æˆ·</span>
    <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// ä¿®æ”¹å¯†ç </span>
    <span class="token keyword">void</span> <span class="token function">changePassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> oldPassword<span class="token punctuation">,</span> <span class="token class-name">String</span> newPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">boolean</span> <span class="token function">userExists</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>InMemoryUserDetailsManager</strong> (ä½äºorg.springframework.security.provisioningåŒ…ä¸‹)å†…å­˜ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ç®¡ç†å™¨ï¼Œè¿™ä¸ªç±»å®ç°UserDetailsManager æ¥å£ä¸ä»…å¯ä»¥è·å–ç”¨æˆ·ä¿¡æ¯è¿˜æœ‰è‡ªå·±çš„ä¸€å¥—ç”¨æˆ·ä¿¡æ¯ç®¡ç†å‘æ–¹å¼ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜åœ¨åœ¨Mapä¸­è¿›è¡Œç®¡ç†CIUDæ“ä½œï¼Œè™½ç„¶å¾ˆæ˜¯æ–¹ä¾¿ä½†æ˜¯å¯¹ç”¨æˆ·æ•°æ®æ²¡æœ‰åšæŒä¹…åŒ–æ“ä½œï¼Œç³»ç»Ÿå…³æœºæ—¶ç”¨æˆ·ä¿¡æ¯éƒ½ä¼šæ¶ˆå¤±ï¼›InMemoryUserDetailsManager è¿˜å®ç°äº†==UserDetailsPasswordService == (ä½äºorg.springframework.security.core.userdetailsåŒ…ä¸‹)æ¥å£ç”¨æˆ·è¯¦ç»†ä¿¡æ¯å¯†ç æœåŠ¡ï¼Œä¸»è¦è¿›è¡Œä¼˜åŒ–å¯†ç æ›´æ–°å¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetailsPasswordService</span> <span class="token punctuation">{</span>
   <span class="token comment">// ä¿®æ”¹å¯†ç  è¿”å›ç”¨æˆ·è¯¦æƒ…</span>
    <span class="token class-name">UserDetails</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> newPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InMemoryUserDetailsManager</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsManager</span><span class="token punctuation">,</span> <span class="token class-name">UserDetailsPasswordService</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Log</span> logger <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç”¨äºç®¡ç†ç”¨æˆ·ä¿¡æ¯çš„Map(å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ²¡æœ‰æŒä¹…åŒ–åŠŸèƒ½çš„å†…å­˜æ•°æ®åº“)</span>
    <span class="token comment">// æ„Ÿè§‰MutableUserDetailså¯å˜ç”¨æˆ·æ¥å£çš„å®ç°ä¸»è¦ä¸ºSpringSecurityå†…éƒ¨</span>
    <span class="token comment">// è‡ªå·±çš„ç”¨æˆ·ç®¡ç†æ–¹å¼æä¾›å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„ç±»</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MutableUserDetails</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¤è¯ç®¡ç†å™¨</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ„é€ å™¨  åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ å¹¶æ·»åŠ åˆ°mapä¸­</span>
    <span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserDetails</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Iterator</span> var2 <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span>var2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDetails</span><span class="token punctuation">)</span>var2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
   
      <span class="token comment">// æ„é€ å™¨  åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ å¹¶æ·»åŠ åˆ°mapä¸­</span>
    <span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDetails</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var2 <span class="token operator">=</span> users<span class="token punctuation">;</span>
        <span class="token keyword">int</span> var3 <span class="token operator">=</span> users<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> var4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> var4 <span class="token operator">&lt;</span> var3<span class="token punctuation">;</span> <span class="token operator">++</span>var4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> var2<span class="token punctuation">[</span>var4<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    
      <span class="token comment">// æ„é€ å™¨  åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯ å¹¶æ·»åŠ åˆ°mapä¸­</span>
    <span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> names <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">propertyNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserAttributeEditor</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserAttributeEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span>names<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>names<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            editor<span class="token punctuation">.</span><span class="token function">setAsText</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">UserAttribute</span> attr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserAttribute</span><span class="token punctuation">)</span>editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">&quot;The entry with username &#39;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;&#39; could not be converted to an UserDetails&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createUserDetails</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">User</span> <span class="token function">createUserDetails</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">UserAttribute</span> attr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ›å»ºç”¨æˆ·å¹¶æ·»åŠ åˆ°mapä¸­</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userExists</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;user should not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MutableUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä»mapç§»é™¤ç”¨æˆ·</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   
    <span class="token comment">// æ›´æ–°mapä¸­çš„ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userExists</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;user should exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MutableUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä»¥å­˜åœ¨</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">userExists</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä¿®æ”¹å¯†ç </span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changePassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> oldPassword<span class="token punctuation">,</span> <span class="token class-name">String</span> newPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// ä»è®¤è¯ä¸Šä¸‹æ–‡ä¸­è·å–è®¤è¯åçš„ç”¨æˆ·ä¿¡æ¯</span>
        <span class="token class-name">Authentication</span> currentUser <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// æ— æ³•æ›´æ”¹å¯†ç ï¼Œå› ä¸ºåœ¨å½“å‰ç”¨æˆ·çš„ä¸Šä¸‹æ–‡ä¸­æ‰¾ä¸åˆ°èº«ä»½éªŒè¯å¯¹è±¡</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AccessDeniedException</span><span class="token punctuation">(</span><span class="token string">&quot;Can&#39;t change password as no Authentication object found in context for current user.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–ç”¨æˆ·åç§°</span>
            <span class="token class-name">String</span> username <span class="token operator">=</span> currentUser<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Changing password for user &#39;%s&#39;&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>authenticationManager <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Reauthenticating user &#39;%s&#39; for password change request.&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è®¤è¯ç”¨æˆ·ä¿¡æ¯ï¼Œæ£€æŸ¥ä¹‹å‰çš„ç”¨æˆ·ä¿¡æ¯</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>authenticationManager<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> oldPassword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;No authentication manager set. Password won&#39;t be re-checked.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// ä»mapä¸­è·å–ç”¨æˆ·ä¿¡æ¯</span>
            <span class="token class-name">MutableUserDetails</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MutableUserDetails</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;Current user doesn&#39;t exist in database.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è®¾ç½®æ–°çš„å¯†ç </span>
            user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>newPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ›´æ–°å¯†ç å¹¶è¿”å›ç”¨æˆ·è¯¦æƒ…ä¿¡æ¯</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">updatePassword</span><span class="token punctuation">(</span><span class="token class-name">UserDetails</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> newPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MutableUserDetails</span> mutableUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MutableUserDetails</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mutableUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>newPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mutableUser<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// é€šè¿‡ç”¨æˆ·åç§°ä»mapä¸­è·å–ç”¨æˆ·è¯¦æƒ…ä¿¡æ¯</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserDetails</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è®¾ç½®è®¤è¯ç®¡ç†å™¨</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAuthenticationManager</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>authenticationManager <span class="token operator">=</span> authenticationManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-userdetailserviceautoconfigutationç±»" tabindex="-1"><a class="header-anchor" href="#_3-2-userdetailserviceautoconfigutationç±»" aria-hidden="true">#</a> 3.2 UserDetailServiceAutoConfigutationç±»</h3><p>åœ¨ SpringBoot çš„è‡ªåŠ¨è£…é…ä¸­ï¼Œé»˜è®¤ä¼šå¯åŠ¨é…ç½®ç±» <strong>UserDetailServiceAutoConfigutation</strong> ï¼š</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312070922010.png" alt="1700842772209" tabindex="0" loading="lazy"><figcaption>1700842772209</figcaption></figure><p>åœ¨é…ç½®ç±» <strong>UserDetailServiceAutoConfigutation</strong> é»˜è®¤ç”Ÿæ•ˆæ—¶ä¼šæä¾› InMemoryUserDetailManager çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯åŸºäºå†…å­˜çš„å®ç°ã€‚</p><blockquote><p>é…ç½®ç±» <strong>UserDetailServiceAutoConfigutation</strong> é»˜è®¤ç”Ÿæ•ˆçš„æ¡ä»¶æœ‰ä¸‰ç§æƒ…å†µï¼š</p><ol><li>åœ¨ classpath ä¸‹å­˜åœ¨ <strong>AuthenticationManager</strong> ç±»</li><li>å½“å‰åº”ç”¨ä¸­ï¼Œå­˜åœ¨ <strong>ObjectPostProcessor</strong> ç±»çš„å®ä¾‹æ—¶</li><li>å½“å‰åº”ç”¨ä¸­ï¼Œä¸å­˜åœ¨ <strong>AuthenticationManager</strong>.classã€ <strong>AuthenticationProvider</strong>.classã€<strong>UserDetailsService</strong>.classã€ <strong>AuthenticationManagerResolver</strong>.class çš„å®ä¾‹æ—¶</li></ol></blockquote><p>æˆ‘ä»¬æ¥ç€å»çœ‹çœ‹ <strong>UserDetailServiceAutoConfigutation</strong>è¿™ä¸ªç±»çš„å…·ä½“å®ç°</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312070923332.png" alt="image-20231207092338286" tabindex="0" loading="lazy"><figcaption>image-20231207092338286</figcaption></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹@ConditionalOnMissingBeanè¿™ä¸ªæ³¨è§£ï¼Œä»–æ˜¯æ ¸å¿ƒã€‚</p><p><strong>@ConditionalOnMissingBean</strong>æ˜¯ä¸€ä¸ªæ³¨è§£å‡½æ•°ï¼Œç”¨äºåœ¨SpringSecurityä¸­æ¡ä»¶åœ°æ£€æŸ¥æ˜¯å¦ç¼ºå°‘æŒ‡å®šç±»å‹çš„beanã€‚å¦‚æœç¼ºå°‘æŒ‡å®šç±»å‹çš„beanï¼Œåˆ™ä¼šæ‰§è¡Œä¸€äº›ç‰¹å®šçš„æ“ä½œã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œå¦‚æœç¼ºå°‘AuthenticationManagerã€AuthenticationProviderã€UserDetailsServiceã€AuthenticationManagerResolverç±»å‹çš„beanï¼Œä»¥åŠJwtDecoderã€OpaqueTokenIntrospectorã€ClientRegistrationRepositoryã€RelyingPartyRegistrationRepositoryç±»å‹çš„beanï¼Œå°†ä¼šæ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬è¿™é‡Œçš„è¡¨å•éªŒè¯ï¼Œå¹¶æ²¡æœ‰å¯¹UserDeatilServiceè¿™ä¸ªæ¥å£è¿›è¡Œå®ç°ï¼Œå¹¶æ²¡æœ‰å¯¹ä»¥ä¸Šbeanè¿›è¡Œæ¿€æ´»ï¼Œæ‰€ä»¥ä»–å°±æ˜¯ç›´æ¥èµ°äº†é»˜è®¤çš„é…ç½®ã€‚</p><h2 id="_4-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_4-å°ç»“" aria-hidden="true">#</a> 4.å°ç»“</h2><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312070928418.png" alt="1700845195593" tabindex="0" loading="lazy"><figcaption>1700845195593</figcaption></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ <strong>UserDetailService</strong> æ¥å£çš„å®ç°ç±»ï¼Œå¯ä»¥ä¿®æ”¹é»˜è®¤è®¤è¯è§„åˆ™ã€‚</p><h2 id="_5-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_5-æ€»ç»“" aria-hidden="true">#</a> 5.æ€»ç»“</h2><p>ä»¥ä¸Šä¾¿æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ï¼Œæœ¬äººæ‰ç–å­¦æµ…ï¼Œæ–‡ç« æœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§ä½¬ä»¬æ‰¹è¯„æŒ‡æ­£ï¼æˆ‘æ˜¯<strong>Leo</strong>ï¼Œä¸€ä¸ªåœ¨äº’è”ç½‘è¡Œä¸šçš„å°ç™½ï¼Œç«‹å¿—æˆä¸ºæ›´å¥½çš„è‡ªå·±ã€‚</p><p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº<strong>Leo</strong>ï¼Œå¯ä»¥å…³æ³¨å…¬ä¼—å·-ç¨‹åºå‘˜Leoï¼Œåé¢æ–‡ç« ä¼šé¦–å…ˆåŒæ­¥è‡³å…¬ä¼—å·ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312070929403.png" alt="å…¬ä¼—å·å°é¢" tabindex="0" loading="lazy"><figcaption>å…¬ä¼—å·å°é¢</figcaption></figure>`,33);function d(m,v){const t=p("ExternalLinkIcon");return o(),c("div",null,[u,s("p",null,[n("å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Leoå“¥ğŸ«£ğŸ«£ğŸ«£ï¼Œæ¥åˆ°"),s("a",r,[n("ä¸Šä¸€èŠ‚"),i(t)]),n("ï¼Œæˆ‘ä»¬å­¦ä¹ äº†SpringSecurityé»˜è®¤ç™»å½•ç”¨æˆ·æ˜¯å¦‚ä½•æ¥çš„ï¼Œä¹Ÿé€šè¿‡æºç çš„æ–¹å¼å»éªŒè¯äº†æˆ‘ä»¬çš„çŒœæƒ³ã€‚é‚£ä¹ˆæœ¬ç¯‡æ–‡ç« ç»§ç»­è®²è§£æœ‰å…³æœ€åUserDetailedServiceè¿™ä¸ªæ¥å£çš„ç›¸å…³å†…å®¹ã€‚")]),k])}const h=e(l,[["render",d],["__file","default-user2.html.vue"]]);export{h as default};
