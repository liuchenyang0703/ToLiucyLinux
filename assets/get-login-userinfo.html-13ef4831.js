import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as p,c as i,a,b as n,d as t,e as c}from"./app-8d307529.js";const l={},u=a("figure",null,[a("img",{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312270933695.png",alt:"image-20231030235443828",tabindex:"0",loading:"lazy"}),a("figcaption",null,"image-20231030235443828")],-1),r=a("h2",{id:"_1-å‰è¨€",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#_1-å‰è¨€","aria-hidden":"true"},"#"),n(" 1.å‰è¨€")],-1),g={href:"https://gaoziman.blog.csdn.net/article/details/135237133",target:"_blank",rel:"noopener noreferrer"},d=a("h2",{id:"_2-æ¦‚è¿°",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#_2-æ¦‚è¿°","aria-hidden":"true"},"#"),n(" 2.æ¦‚è¿°")],-1),h={href:"https://gaoziman.blog.csdn.net/article/details/135237133",target:"_blank",rel:"noopener noreferrer"},k=c(`<figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312270957478.png" alt="image-20231227095749441" tabindex="0" loading="lazy"><figcaption>image-20231227095749441</figcaption></figure><h2 id="_3-è·å–ç”¨æˆ·è®¤è¯ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_3-è·å–ç”¨æˆ·è®¤è¯ä¿¡æ¯" aria-hidden="true">#</a> 3.è·å–ç”¨æˆ·è®¤è¯ä¿¡æ¯</h2><p>æˆ‘ä»¬ç™»å½•ä¹‹åï¼Œæˆ‘ä»¬ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•è¿›è¡Œè·å–å‘¢ï¼Œä»Šå¤©æˆ‘ä»¬æ¥ç€å¾€ä¸‹èŠã€‚</p><p>ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œç”¨æˆ·çš„ä¿¡æ¯å­˜å‚¨åœ¨ <code>SecurityContext</code> ä¸­ã€‚<code>SecurityContext</code> æ˜¯ç”± <code>SecurityContextHolder</code> ç®¡ç†çš„ï¼Œå®ƒæ˜¯ Spring Security çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚</p><p><strong>å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹</strong></p><ol><li><strong>ç”¨æˆ·è®¤è¯</strong>ï¼šå½“ç”¨æˆ·é€šè¿‡è¡¨å•ç™»å½•æˆ–å…¶ä»–è®¤è¯æ–¹å¼æˆåŠŸç™»å½•åï¼ŒSpringSecurity ä¼šåˆ›å»ºä¸€ä¸ª **Authentication ** å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ã€‚</li><li><strong>å­˜å‚¨è®¤è¯ä¿¡æ¯</strong>ï¼š<code>Authentication</code> å¯¹è±¡è¢«å­˜å‚¨åœ¨ <code>SecurityContext</code> ä¸­ã€‚</li><li><strong>ä¸Šä¸‹æ–‡ç®¡ç†</strong>ï¼š<code>SecurityContext</code> ç”± <code>SecurityContextHolder</code> ç®¡ç†ï¼Œé€šå¸¸ä¸å½“å‰çº¿ç¨‹ç»‘å®šï¼Œä»¥ç¡®ä¿åœ¨è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å¯ä»¥éšæ—¶è®¿é—®ç”¨æˆ·ä¿¡æ¯ã€‚</li></ol><p>æˆ‘ä»¬é€šè¿‡å®˜ç½‘çš„ä¸€å¼ å›¾æ›´æ¸…æ™°çš„æ¥äº†è§£SecurityContextHolderã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406211408759.png" alt="image-20240621140850737" tabindex="0" loading="lazy"><figcaption>image-20240621140850737</figcaption></figure><p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>SecurityContextHolder</code> æ¥è·å–ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯äº†ã€‚è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œåœ¨æˆ‘ä»¬ä¹‹å‰çš„helloæ¥å£æ·»åŠ å¿…è¦ä»£ç å³å¯ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406211404169.png" alt="image-20240621140440102" tabindex="0" loading="lazy"><figcaption>image-20240621140440102</figcaption></figure><p>æ­¤æ—¶ï¼Œç™»å½•æˆåŠŸä¹‹åè®¿é—®helloæ¥å£ï¼Œå³å¯åœ¨ideaæ§åˆ¶å°ä¸­çœ‹åˆ°æˆ‘ä»¬çš„ä¿¡æ¯ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406211407806.png" alt="image-20240621140711781" tabindex="0" loading="lazy"><figcaption>image-20240621140711781</figcaption></figure><h2 id="_4-æ¢çŸ¥åŸç†" tabindex="-1"><a class="header-anchor" href="#_4-æ¢çŸ¥åŸç†" aria-hidden="true">#</a> 4. æ¢çŸ¥åŸç†</h2><p>ä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†é€šè¿‡ <strong>SecurityContextHolder</strong> è¿™ä¸ªç±»æ¥è·å–ç”¨æˆ·è®¤è¯ä¿¡æ¯ï¼Œé‚£ä¹ˆå†…éƒ¨ç©¶ç«Ÿæ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ã€‚æˆ‘ä»¬æ‰“å¼€æºç ä¸€æ¢ç©¶ç«Ÿã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406211415147.png" alt="image-20240621141524116" tabindex="0" loading="lazy"><figcaption>image-20240621141524116</figcaption></figure><p><code>SecurityContextHolder</code> é€šè¿‡ <code>initializeStrategy</code> æ–¹æ³•åˆå§‹åŒ–å®‰å…¨ä¸Šä¸‹æ–‡çš„å­˜å‚¨ç­–ç•¥ï¼Œæ ¹æ®é…ç½®é€‰æ‹©é€‚å½“çš„ç­–ç•¥ç±»æ¥ç®¡ç†å®‰å…¨ä¸Šä¸‹æ–‡ã€‚åœ¨é»˜è®¤æƒ…</p><p>å†µä¸‹ï¼Œä½¿ç”¨ <code>ThreadLocal</code> å­˜å‚¨å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åˆ‡æ¢åˆ°å¯ç»§æ‰¿çš„çº¿ç¨‹æœ¬åœ°å˜é‡ç­–ç•¥ã€‚</p><p>é‚£ä¹ˆï¼Œç”¨æˆ·çš„è®¤è¯æ•°æ®æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å­˜å‚¨çš„å‘¢ï¼Ÿ</p><p>è¡¨å•è®¤è¯æ—¶ï¼Œåœ¨ AbstractAuthenticationProcessingFilter è¿‡æ»¤å™¨çš„ doFilter() æ–¹æ³•ä¸­ï¼Œè°ƒç”¨UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨çš„ <strong>attemptAuthentication()</strong> æ–¹æ³•è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œè®¤è¯é€šè¿‡åˆ™è¿”å›è®¤è¯åçš„ Authentication å¯¹è±¡ï¼Œå¦åˆ™è¿”å› null ã€‚è®¤è¯æˆåŠŸåï¼Œä¼šå†è°ƒç”¨è‡ªå·²çš„successfulAuthentication() æ–¹æ³•å­˜å‚¨å½“å‰çš„è®¤è¯ä¿¡æ¯ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406211417865.png" alt="image-20240621141759834" tabindex="0" loading="lazy"><figcaption>image-20240621141759834</figcaption></figure><p>åœ¨ AbstractAuthenticationProcessingFilter è¿‡æ»¤å™¨çš„ successfulAuthentication() æ–¹æ³•ä¸­ï¼ŒæŠŠéªŒè¯é€šè¿‡çš„ç”¨æˆ·è®¤è¯ä¿¡æ¯å…ˆå­˜å…¥ SecurityContext ï¼Œç„¶åå†è°ƒç”¨ThreadLocalSecurityContextHolderStrategy ç±»ä¸­çš„ setContext() æ–¹æ³•ï¼ŒæŠŠ SecurityContext å­˜å…¥ThreadLocal ä¸­ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406211418271.png" alt="image-20240621141842244" tabindex="0" loading="lazy"><figcaption>image-20240621141842244</figcaption></figure><p>è°ƒç”¨ ThreadLocalSecurityContextHolderStrategy ç±»ä¸­çš„ <strong>setContext()</strong> æ–¹æ³•ï¼ŒæŠŠ SecurityContext å­˜å…¥ ThreadLocal ä¸­ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406211419797.png" alt="image-20240621141912757" tabindex="0" loading="lazy"><figcaption>image-20240621141912757</figcaption></figure><h2 id="_5-ç½‘é¡µæ‹“å±•" tabindex="-1"><a class="header-anchor" href="#_5-ç½‘é¡µæ‹“å±•" aria-hidden="true">#</a> 5. ç½‘é¡µæ‹“å±•</h2><p>é™¤äº†åœ¨æˆ‘ä»¬Javaåç«¯é€šè¿‡ <strong>SecurityContextHolder</strong> è·å–ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åœ¨å‰ç«¯ç½‘é¡µä¸Šè·å–æˆ‘ä»¬çš„ç™»å½•ä¿¡æ¯ï¼Œä¸‹é¢è·Ÿç€ä¸€èµ·æ¥æ“ä½œå§ã€‚</p><h3 id="_5-1-å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_5-1-å¼•å…¥ä¾èµ–" aria-hidden="true">#</a> 5.1 å¼•å…¥ä¾èµ–</h3><p>åœ¨pomæ–‡ä»¶ä¸­å¼•å…¥ä»¥ä¸‹ä¾èµ–ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> 
  	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf.extras<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
   	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-extras-springsecurity6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-å¼•å…¥å‘½åç©ºé—´" tabindex="-1"><a class="header-anchor" href="#_5-2-å¼•å…¥å‘½åç©ºé—´" aria-hidden="true">#</a> 5.2 å¼•å…¥å‘½åç©ºé—´</h3><p>åœ¨login.htmlä¸­å¼•å…¥æŒ‡å®šçš„å‘½åç©ºé—´ã€‚</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.thymeleaf.org<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>sec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org/extras/spring-security<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_5-3-åœ¨ç½‘é¡µä¸­ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_5-3-åœ¨ç½‘é¡µä¸­ä½¿ç”¨" aria-hidden="true">#</a> 5.3 åœ¨ç½‘é¡µä¸­ä½¿ç”¨</h3><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token comment">&lt;!--è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.authorities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.accountNonExpired<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.accountNonLocked<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">sec:</span>authentication</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>principal.credentialsNonExpired<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-å°ç»“" tabindex="-1"><a class="header-anchor" href="#_6-å°ç»“" aria-hidden="true">#</a> 6. å°ç»“</h2><ul><li>SecurityContextHolderï¼šæä¾›å¯¹ SecurityContext å®‰å…¨ä¸Šä¸‹æ–‡çš„è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨ ThreadLocal å¯¹è±¡æ¥å­˜å‚¨å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>SecurityContextï¼šå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå†…éƒ¨åŒ…å«äº†å½“å‰è®¤è¯ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li>Authenticationï¼šå­˜å‚¨å½“å‰ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼ˆPrincipal ç”¨æˆ·ä¿¡æ¯ã€Credentials å¯†ç ä¿¡æ¯ã€Authorities æƒé™ä¿¡æ¯ï¼‰ã€‚</li></ul><p><strong>SecurityContextHolderæœ‰ä¸‰ç§å·¥ä½œç­–ç•¥æ¨¡å¼ï¼š</strong></p><ul><li>MODE_THREADLOCAL(é»˜è®¤)ï¼šæœ¬åœ°çº¿ç¨‹æ¨¡å¼ï¼Œå°†è®¤è¯ç”¨æˆ·ä¿¡æ¯å’Œå½“å‰çº¿ç¨‹ç»‘å®šå­˜åœ¨ThreadLocal ä¸­ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…å¯ä»¥è·å–åˆ°ç›¸åŒçš„å®‰å…¨ä¸Šä¸‹æ–‡</li><li>MODE_INHERITABLETHREADLOCALï¼šå¯ç»§æ‰¿çš„æœ¬åœ°çº¿ç¨‹æ¨¡å¼ï¼Œå°†å®‰å…¨ä¸Šä¸‹æ–‡å¤åˆ¶ç»™å½“å‰çº¿ç¨‹çš„å­çº¿ç¨‹ï¼Œå°±å¯ä»¥å®ç°å¤šä¸ªçˆ¶å­çº¿ç¨‹å¯ä»¥å…±äº«å®‰å…¨ä¸Šä¸‹æ–‡</li><li>MODE_GLOBALï¼šå…¨å±€æ¨¡å¼ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„å®‰å…¨ä¸Šä¸‹æ–‡å®ä¾‹</li></ul><h2 id="_7-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_7-æ€»ç»“" aria-hidden="true">#</a> 7. æ€»ç»“</h2><p>ä»¥ä¸Šä¾¿æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ï¼Œæœ¬äººæ‰ç–å­¦æµ…ï¼Œæ–‡ç« æœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§ä½¬ä»¬æ‰¹è¯„æŒ‡æ­£ï¼æˆ‘æ˜¯<strong>Leo</strong>ï¼Œä¸€ä¸ªåœ¨äº’è”ç½‘è¡Œä¸šçš„å°ç™½ï¼Œç«‹å¿—æˆä¸ºæ›´å¥½çš„è‡ªå·±ã€‚</p><p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº<strong>Leo</strong>ï¼Œå¯ä»¥å…³æ³¨å…¬ä¼—å·-ç¨‹åºå‘˜Leoï¼Œåé¢æ–‡ç« ä¼šé¦–å…ˆåŒæ­¥è‡³å…¬ä¼—å·ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/LeoPic202312270933747.png" alt="å…¬ä¼—å·å°é¢" tabindex="0" loading="lazy"><figcaption>å…¬ä¼—å·å°é¢</figcaption></figure>`,43);function m(f,x){const s=o("ExternalLinkIcon");return p(),i("div",null,[u,r,a("p",null,[n("å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Leoå“¥ğŸ«£ğŸ«£ğŸ«£ï¼Œæ¥åˆ°"),a("a",g,[n("ä¸Šä¸€èŠ‚"),t(s)]),n("ï¼Œæˆ‘ä»¬å­¦ä¹ é€šè¿‡SpringSecurityé€€å‡ºç™»å½•ä¹‹åçš„JSONå¤„ç†ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦æ¥ä»‹ç»ä¸€ä¸‹ç™»å½•æˆåŠŸä¹‹åå¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯ã€‚å¥½äº†ï¼Œè¯ä¸å¤šè¯´è®©æˆ‘ä»¬å¼€å§‹å§ğŸ˜ğŸ˜ğŸ˜ã€‚")]),d,a("p",null,[n("åœ¨"),a("a",h,[n("è¿™ç¯‡æ–‡ç« ä¸­"),t(s)]),n("æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªä¸»é¡µé¢ï¼Œç”¨è¶…é“¾æ¥æ¥è¿›è¡Œé€€å‡ºç™»å½•ï¼Œè€Œä¸æ˜¯é¢‘ç¹åœ¨åœ°å€æ è¾“å…¥URLã€‚")]),k])}const v=e(l,[["render",m],["__file","get-login-userinfo.html.vue"]]);export{v as default};
