import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as e,o,c,a as s,b as n,d as i,e as a}from"./app-8d307529.js";const l={},u=a(`<figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406221046153.png" alt="image-20231030235443828" tabindex="0" loading="lazy"><figcaption>image-20231030235443828</figcaption></figure><h2 id="_1-å‰è¨€" tabindex="-1"><a class="header-anchor" href="#_1-å‰è¨€" aria-hidden="true">#</a> 1.å‰è¨€</h2><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Leoå“¥ğŸ«£ğŸ«£ğŸ«£ï¼Œé€šè¿‡å‰é¢å‡ èŠ‚çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¦‚æœé€šè¿‡å†…å­˜è¿›è¡Œç™»å½•è®¤è¯ä»¥åŠå¦‚ä½•è·å–ç™»å½•ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·éƒ½æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶éç›´æ¥å­˜æ”¾åœ¨æœ¬åœ°å†…å­˜ä¸­ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿™ç¯‡åšå®¢å°†åŸºäºæ•°æ®åº“çš„ç”¨æˆ·æ¥å®ç°æˆ‘ä»¬çš„ç™»å½•è®¤è¯ã€‚</p><h2 id="_2-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_2-æ¦‚è¿°" aria-hidden="true">#</a> 2.æ¦‚è¿°</h2><p>å…¶å®ç”¨æˆ·è¿›è¡Œè®¤è¯ï¼Œæœ€å¸¸è§çš„è®¤è¯æ–¹å¼å°±æ˜¯ <strong>ç”¨æˆ·å+å¯†ç </strong>ï¼Œè®¤è¯æœåŠ¡éœ€è¦æ ¹æ®<strong>ç”¨æˆ·å</strong>ä»å­˜å‚¨ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååˆ¤æ–­è¾“å…¥çš„<strong>å¯†ç </strong>å’Œå­˜å‚¨ä¸­çš„<strong>å¯†ç </strong>æ˜¯å¦åŒ¹é…ã€‚</p><p>å¯¹ç”¨æˆ·åã€å¯†ç å­˜å‚¨ï¼Œ<code>SpringSecurity</code>æ”¯æŒå¤šç§å­˜å‚¨æœºåˆ¶ï¼š</p><ul><li>å†…å­˜</li><li><code>JDBC</code> å…³ç³»å‹æ•°æ®åº“</li><li>ä½¿ç”¨<code>UserDetailsService</code>çš„è‡ªå®šä¹‰æ•°æ®å­˜å‚¨</li><li>ä½¿ç”¨ <code>LDAP</code>è®¤è¯çš„ <code>LDAP</code> å­˜å‚¨</li></ul><p>åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚æœé€šè¿‡å†…å­˜è¿›è¡Œç™»å½•è®¤è¯ï¼Œæœ¬ç¯‡åˆ™æ˜¯ä¸»è¦ä»‹ç»åŸºäºæ•°æ®åº“è¿›è¡Œè®¤è¯ã€‚å…¶ä»–ä¸¤ç§æ–¹å¼ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è¿›è¡Œè‡ªè¡Œç ”ç©¶ï¼Œä¸åœ¨æœ¬ç³»åˆ—æ•™ç¨‹çš„ç ”ç©¶èŒƒå›´å†…ã€‚</p><h2 id="_3-ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#_3-ç¯å¢ƒæ­å»º" aria-hidden="true">#</a> 3.ç¯å¢ƒæ­å»º</h2><h3 id="_3-1-å‡†å¤‡æ•°æ®åº“ä»¥åŠè¡¨ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_3-1-å‡†å¤‡æ•°æ®åº“ä»¥åŠè¡¨ç»“æ„" aria-hidden="true">#</a> 3.1 å‡†å¤‡æ•°æ®åº“ä»¥åŠè¡¨ç»“æ„</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>  <span class="token comment">-- ç”¨æˆ·è¡¨</span>
 
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>enabled<span class="token punctuation">\`</span></span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>account_non_expired<span class="token punctuation">\`</span></span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>account_non_locked<span class="token punctuation">\`</span></span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>credentials_non_expired<span class="token punctuation">\`</span></span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>




<span class="token comment">-- è§’è‰²è¡¨</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>describe<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

 
<span class="token comment">-- åˆ›å»º sysuser_role è¡¨</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>sysuser_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>uid<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">\`</span>rid<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">\`</span>uid<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>uid<span class="token punctuation">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">\`</span>rid<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>rid<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">5</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- æ’å…¥ç”¨æˆ·æ•°æ®</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>enabled<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>account_non_expired<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>account_non_locked<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>credentials_non_expired<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{noop}123&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{noop}123&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;Leo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;{noop}123&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- æ’å…¥è§’è‰²æ•°æ®</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>sys_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>name<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>describe<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;ROLE_super&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;è¶…çº§ç®¡ç†å‘˜&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;ROLE_admin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;æ™®é€šç®¡ç†å‘˜&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;ROLE_user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;æ™®é€šç”¨æˆ·&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- æ’å…¥ç”¨æˆ·è§’è‰²æ•°æ®</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">\`</span>sysuser_role<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>uid<span class="token punctuation">\`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">\`</span>rid<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-åˆ›å»ºé¡¹ç›®é›†æˆmybatisplus" tabindex="-1"><a class="header-anchor" href="#_3-2-åˆ›å»ºé¡¹ç›®é›†æˆmybatisplus" aria-hidden="true">#</a> 3.2 åˆ›å»ºé¡¹ç›®é›†æˆMybatisPlus</h3><p>å¼•å…¥å…¶ä»–ä¾èµ–ä»¥åŠmybatisplusä¾èµ–ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--  hutoolå·¥å…·åŒ… --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ·»åŠ application.ymlé…ç½®æ–‡ä»¶</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8700</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># æ•°æ®åº“é…ç½®</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//xxxx<span class="token punctuation">:</span>3307/security_db<span class="token punctuation">?</span>zeroDateTimeBehavior=convertToNull<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&amp;autoReconnect=true</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> xxxx
    <span class="token key atrule">password</span><span class="token punctuation">:</span> xxxx





<span class="token comment"># mybatis-plusé…ç½®</span>
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token comment">#é…ç½®Mapperæ˜ å°„æ–‡ä»¶</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/mapper/<span class="token important">*.xml</span>
  <span class="token comment"># é…ç½®Mybatisæ•°æ®è¿”å›ç±»å‹åˆ«åï¼ˆé»˜è®¤åˆ«åä¸ºç±»åï¼‰</span>
  <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> org.leocoder.db.domain
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token comment"># è‡ªåŠ¨é©¼å³°å‘½å</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">logic-delete-field</span><span class="token punctuation">:</span> isDelete <span class="token comment"># å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå(since 3.3.0,é…ç½®åå¯ä»¥å¿½ç•¥ä¸é…ç½®æ­¥éª¤2)</span>
      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># é€»è¾‘å·²åˆ é™¤å€¼(é»˜è®¤ä¸º 1)</span>
      <span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># é€»è¾‘æœªåˆ é™¤å€¼(é»˜è®¤ä¸º 0)</span>

<span class="token comment">#é…ç½®æ§åˆ¶å°æ‰“å°æ—¥å¿—Debug</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">org.leocoder.db.mapper</span><span class="token punctuation">:</span> debug
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åç”Ÿæˆmybatisplusçš„ä»£ç å³å¯ã€‚</p><p>åˆ«å¿˜äº†åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ <code>@MapperScan</code>æ‰«æï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;org.leocoder.db.mapper&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-ç¯å¢ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-3-ç¯å¢ƒæµ‹è¯•" aria-hidden="true">#</a> 3.3 ç¯å¢ƒæµ‹è¯•</h3><p>åœ¨æµ‹è¯•ç±»ä¸­æ·»åŠ æµ‹è¯•ä»£ç ï¼ŒæŸ¥éªŒç¯å¢ƒæ˜¯å¦æ­å»ºæˆåŠŸï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">DbApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SysUserService</span> userService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     *  ç”¨äºæµ‹è¯•: æµ‹è¯•ä»£ç æ˜¯å¦æ­£å¸¸
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SysUser</span> admin <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æˆåŠŸçš„æŸ¥å‡ºæˆ‘ä»¬æ•°æ®åº“çš„ç”¨æˆ·äº†ï¼ŒåŸºæœ¬ç¯å¢ƒæ­å»ºæˆåŠŸï¼</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202407012336899.png" alt="image-20240701233620838" tabindex="0" loading="lazy"><figcaption>image-20240701233620838</figcaption></figure><h2 id="_4-å›é¡¾è®¤è¯æ•´ä½“æµç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-å›é¡¾è®¤è¯æ•´ä½“æµç¨‹" aria-hidden="true">#</a> 4.å›é¡¾è®¤è¯æ•´ä½“æµç¨‹</h2><p>SpringSecurityçš„æ•´ä¸ªè®¤è¯æµç¨‹å…¶å®å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡ä¸€å¼ å»ºè®®çš„æµç¨‹å›¾æ¥äº†è§£ä¸€ä¸‹æ•°æ®åº“çš„æ•´ä¸ªè®¤è¯æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202407012344545.png" alt="image-20240701234437477" tabindex="0" loading="lazy"><figcaption>image-20240701234437477</figcaption></figure><ol><li><strong>ç”¨æˆ·æäº¤ç”¨æˆ·åå’Œå¯†ç </strong>ï¼šç”¨æˆ·åœ¨ç™»å½•é¡µé¢è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œç‚¹å‡»ç™»å½•æŒ‰é’®ï¼Œæµè§ˆå™¨å°†è¡¨å•æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ã€‚</li><li><strong>å°è£…è¯·æ±‚ä¿¡æ¯</strong>ï¼šSpringSecurityæ‹¦æˆªç™»å½•è¯·æ±‚ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç å°è£…ä¸ºä¸€ä¸ª <code>UsernamePasswordAuthenticationToken</code> å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°äº† <code>Authentication</code> æ¥å£çš„å…·ä½“ç±»ã€‚</li><li><strong>è®¤è¯ç®¡ç†å™¨è®¤è¯</strong>ï¼š<code>AuthenticationManager </code>æ˜¯Spring Securityçš„æ ¸å¿ƒè®¤è¯æ¥å£ï¼Œè´Ÿè´£åè°ƒè®¤è¯è¿‡ç¨‹ã€‚è°ƒç”¨ <code>authenticate() </code>æ–¹æ³•å¼€å§‹è®¤è¯ã€‚</li><li><strong>å§”æ‰˜è®¤è¯</strong>ï¼š<code>AuthenticationManager </code>é€šå¸¸ä¼šå§”æ‰˜ç»™ä¸€ä¸ªæˆ–å¤šä¸ª <code>AuthenticationProvider</code>è¿›è¡Œå…·ä½“çš„è®¤è¯é€»è¾‘ã€‚åœ¨è¿™é‡Œï¼Œ<code>DaoAuthenticationProvider</code>æ˜¯ä¸€ä¸ªå¸¸è§çš„å®ç°ç±»ã€‚</li><li><strong>åŠ è½½ç”¨æˆ·ä¿¡æ¯</strong>ï¼š<code>DaoAuthenticationProvider </code>è°ƒç”¨ <code>UserDetailsService </code>æ¥å£çš„ <code>loadUserByUsername()</code> æ–¹æ³•ï¼Œä»æ•°æ®åº“æˆ–å…¶ä»–å­˜å‚¨ä¸­åŠ è½½ç”¨æˆ·ä¿¡æ¯ã€‚æˆ‘ä»¬é€šå¸¸ä¼šè‡ªå®šä¹‰ä¸€ä¸ª<code>UserDetailsService </code>å®ç°ç±»ï¼Œé€šè¿‡MyBatis Plusæˆ–JPAä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</li><li><strong>è¿”å›ç”¨æˆ·ä¿¡æ¯</strong>ï¼š<code>UserDetailsService </code>å®ç°ç±»ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯åï¼Œè¿”å›ä¸€ä¸ª <code>UserDetails</code> å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œæƒé™ä¿¡æ¯ã€‚</li><li><strong>å¯†ç éªŒè¯</strong>ï¼š<code>DaoAuthenticationProvider </code>ä½¿ç”¨é…ç½®çš„<code>PasswordEncoder</code>ï¼ˆå¦‚<code>BCryptPasswordEncoder</code>ï¼‰å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç å’Œæ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœå¯†ç åŒ¹é…ï¼Œç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™æŠ›å‡ºè®¤è¯å¼‚å¸¸ã€‚</li><li><strong>å¡«å……æƒé™ä¿¡æ¯</strong>ï¼šå¦‚æœå¯†ç éªŒè¯é€šè¿‡ï¼Œ<code>DaoAuthenticationProvider </code>å°†ç”¨æˆ·çš„æƒé™ä¿¡æ¯å¡«å……åˆ°<code>Authentication </code>å¯¹è±¡ä¸­ã€‚æƒé™ä¿¡æ¯é€šå¸¸æ˜¯ä»ç”¨æˆ·çš„è§’è‰²ä¸­æå–çš„ï¼Œå¯ä»¥é€šè¿‡<code>SimpleGrantedAuthority </code>å¯¹è±¡è¡¨ç¤ºã€‚</li><li><strong>è¿”å›è®¤è¯ç»“æœ</strong>ï¼š<code>DaoAuthenticationProvider </code>å°†åŒ…å«ç”¨æˆ·æƒé™ä¿¡æ¯çš„ <code>Authentication</code> å¯¹è±¡è¿”å›ç»™ <code>AuthenticationManager</code>ã€‚</li><li><strong>å­˜å‚¨è®¤è¯ä¿¡æ¯</strong>ï¼š<code>AuthenticationManager </code>å°†è®¤è¯åçš„<code>Authentication </code>å¯¹è±¡å­˜å‚¨åœ¨ <code>SecurityContextHolder</code>ä¸­ã€‚<code>SecurityContextHolder </code>æ˜¯ä¸€ä¸ªå…¨å±€æŒæœ‰è®¤è¯ä¿¡æ¯çš„åœ°æ–¹ï¼Œåç»­çš„å®‰å…¨æ“ä½œéƒ½ä¼šä¾èµ–äºè¿™é‡Œå­˜å‚¨çš„è®¤è¯ä¿¡æ¯ã€‚</li></ol><p>æˆ‘ä»¬æ¥ä¸‹æ¥å†è¯¦ç»†çœ‹çœ‹è¿™å¼ è¯¦ç»†çš„æµç¨‹å›¾ï¼Œæ˜¯å¦å¯¹æ•´ä¸ªè®¤è¯æµç¨‹æ›´åŠ æ¸…æ™°äº†å‘¢ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202407012341177.png" alt="image-20240701234139144" tabindex="0" loading="lazy"><figcaption>image-20240701234139144</figcaption></figure><p>Spring Securityæ˜¯æ€ä¹ˆè¿›è¡Œç”¨æˆ·è®¤è¯çš„å‘¢ï¼Ÿ</p><p><strong><code>AuthenticationManager</code></strong> å°±æ˜¯SpringSecurityç”¨äºæ‰§è¡Œèº«ä»½éªŒè¯çš„ç»„ä»¶ï¼Œåªéœ€è¦è°ƒç”¨å®ƒçš„ <code>authenticate</code> æ–¹æ³•å³å¯å®Œæˆè®¤è¯ã€‚Spring Securityé»˜è®¤çš„è®¤è¯æ–¹å¼å°±æ˜¯åœ¨ <code>UsernamePasswordAuthenticationFilter</code></p><p>è¿™ä¸ªè¿‡æ»¤å™¨ä¸­è¿›è¡Œè®¤è¯çš„ï¼Œè¯¥è¿‡æ»¤å™¨è´Ÿè´£è®¤è¯é€»è¾‘ã€‚</p><p>SpringSecurityç”¨æˆ·è®¤è¯å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ç”Ÿæˆä¸€ä¸ªåŒ…å«è´¦å·å¯†ç çš„è®¤è¯ä¿¡æ¯</span>
<span class="token class-name">Authentication</span> authenticationToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> passwrod<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// AuthenticationManageræ ¡éªŒè¿™ä¸ªè®¤è¯ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªå·²è®¤è¯çš„Authentication</span>
<span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> authenticationManager<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>authenticationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å°†è¿”å›çš„Authenticationå­˜åˆ°ä¸Šä¸‹æ–‡ä¸­</span>
<span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-åŸºäºæ•°æ®åº“è®¤è¯" tabindex="-1"><a class="header-anchor" href="#_5-åŸºäºæ•°æ®åº“è®¤è¯" aria-hidden="true">#</a> 5.åŸºäºæ•°æ®åº“è®¤è¯</h2><h3 id="_5-1-userdetailsserviceæ¥å£" tabindex="-1"><a class="header-anchor" href="#_5-1-userdetailsserviceæ¥å£" aria-hidden="true">#</a> 5.1 UserDetailsServiceæ¥å£</h3><p><strong>UserDetailsService</strong>æ˜¯ **SpringSecurity **ä¸è®¤è¯æ•°æ®äº¤äº’çš„åœ°æ–¹ï¼Œå¦‚æœä½ ä¸é‡å†™ <strong>UserDetailsService</strong>ï¼Œé‚£ä¹ˆ <strong>SpringSecurity <strong>è®¤è¯çš„è¿‡ç¨‹å°±æ˜¯èµ°çš„è‡ªå·±å†…éƒ¨é»˜è®¤çš„é‚£ä¸€å¥—ï¼Œåªèƒ½æ˜¯åœ¨</strong>application.yml</strong> çš„é…ç½®é‡Œå†™æ­»å¸å·å¯†ç å’Œè§’è‰²ï¼Œè¿™æ˜¾ç„¶ä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒè‡ªç„¶è¦ç”¨æ•°æ®åº“é‡Œçš„æ•°æ®è¿›è¡Œç”¨æˆ·è®¤è¯å’Œè·å¾—ç›¸å…³æƒé™ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserDetailService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">SysUserMapper</span> userMapper<span class="token punctuation">;</span>

  
   <span class="token comment">// å› ä¸ºè¿™é‡Œåªæ˜¯åšç®€å•çš„ç™»å½•è®¤è¯ï¼Œå…³äºå…·ä½“çš„æƒé™ç­‰æˆ‘ä»¬åé¢æ¥ç€èŠã€‚</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SysUser</span> sysUser <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sysUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sysUser<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†™ <strong>UserDetailsService</strong>ï¼Œæ˜¯æ¶èµ·ä¸æ•°æ®åº“æ²Ÿé€šçš„æ¡¥æ¢ï¼Œè¿™é‡Œå¼„æ˜ç™½äº†ï¼Œåé¢éƒ½å¾ˆç®€å•äº†ã€‚</p><h3 id="_5-2-userdetailsæ¥å£" tabindex="-1"><a class="header-anchor" href="#_5-2-userdetailsæ¥å£" aria-hidden="true">#</a> 5.2 UserDetailsæ¥å£</h3><p>ä¸¤ä¸ªå®ä½“ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;sys_role&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysRole</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\`name\`&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\`describe\`&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> describe<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>UserDetailsService </code> æ¥å£éœ€è¦è¿”å›ä¸€ä¸ª<code>UserDetails </code>ç±»å‹çš„å¯¹è±¡ï¼Œä»åç§°ä¸Šä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ä¸€ä¸ªå°è£…äº†<strong>ç”¨æˆ·ä¿¡æ¯</strong>çš„ç±»ã€‚æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬æŸ¥è¯¢å‡ºæ¥çš„ç”¨æˆ·å¯¹è±¡ï¼Œè½¬ä¸º<code>Spring Security</code>ä¸­æ”¯æŒçš„ç”¨æˆ·å¯¹è±¡ï¼Œä»¥ä¾¿æ¡†æ¶è¿›è¡Œæ ¡éªŒã€å­˜å‚¨ã€‚</p><p>åœ¨ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè¦æƒ³é€šè¿‡æ•°æ®åº“ç”¨æˆ·è¿›è¡Œè‡ªå®šä¹‰è®¤è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å®ç°UserDetailsè¿™ä¸ªæ¥å£ã€‚ä»–æ˜¯SpringSecurityä¸­ç”¨äºè¡¨ç¤ºç”¨æˆ·å®ä½“çš„æ ¸å¿ƒæ¥å£ã€‚å®ƒæä¾›äº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·åã€å¯†ç ã€æƒé™ç­‰ã€‚</p><p>é€šè¿‡å®ç° <code>UserDetails </code>æ¥å£ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„ç”¨æˆ·å®ä½“ä¸SpringSecurityæ¡†æ¶æ— ç¼é›†æˆï¼Œè¿›è€Œå®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p><p>å®ç° <code>UserDetails </code>æ¥å£éœ€è¦è¦†ç›–ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>getAuthorities()</code>ï¼šè¿”å›ç”¨æˆ·çš„æƒé™é›†åˆï¼Œé€šå¸¸æ˜¯ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯ã€‚</li><li><code>getPassword()</code>ï¼šè¿”å›ç”¨æˆ·çš„å¯†ç ã€‚</li><li><code>getUsername()</code>ï¼šè¿”å›ç”¨æˆ·çš„ç”¨æˆ·åã€‚</li><li><code>isAccountNonExpired()</code>ï¼šæŒ‡ç¤ºç”¨æˆ·çš„è´¦æˆ·æ˜¯å¦æœªè¿‡æœŸã€‚</li><li><code>isAccountNonLocked()</code>ï¼šæŒ‡ç¤ºç”¨æˆ·çš„è´¦æˆ·æ˜¯å¦æœªé”å®šã€‚</li><li><code>isCredentialsNonExpired()</code>ï¼šæŒ‡ç¤ºç”¨æˆ·çš„å‡­è¯ï¼ˆå¯†ç ï¼‰æ˜¯å¦æœªè¿‡æœŸã€‚</li><li><code>isEnabled()</code>ï¼šæŒ‡ç¤ºç”¨æˆ·æ˜¯å¦å¯ç”¨ã€‚</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;sys_user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUser</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">UserDetails</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\`password\`&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;account_non_expired&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> accountNonExpired<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;account_non_locked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> accountNonLocked<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;credentials_non_expired&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> credentialsNonExpired<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token comment">// å…³ç³»å±æ€§ ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysRole</span><span class="token punctuation">&gt;</span></span> roleList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> grantedAuthorities <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        roleList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>role <span class="token operator">-&gt;</span> grantedAuthorities<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">(</span>role<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> grantedAuthorities<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accountNonExpired<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accountNonLocked<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>credentialsNonExpired<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enabled<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-æ·»åŠ é…ç½®ç±»" tabindex="-1"><a class="header-anchor" href="#_5-3-æ·»åŠ é…ç½®ç±»" aria-hidden="true">#</a> 5.3 æ·»åŠ é…ç½®ç±»</h3><p><code>SpringSecurity 6.0</code>å’Œä¹‹å‰çš„é…ç½®æœ‰äº›åŒºåˆ«ï¼Œåç»­æˆ‘ä»¬ä¼šè¯¦ç»†è®²è®²è¿™ä¸€ç‚¹ã€‚</p><p>æ·»åŠ é…ç½®ç±»ï¼ŒåŒæ—¶æˆ‘ä»¬ä¾ç„¶ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰çš„ä¸€äº›ç™»å½•è¡¨å•è¿›è¡Œåç»­æµ‹è¯•ã€‚</p><p>ä»¥åŠè‡ªå®šä¹‰ç™»å½•å“åº”æˆåŠŸä¹‹åçš„JSONã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202407020906790.png" alt="image-20240702090642730" tabindex="0" loading="lazy"><figcaption>image-20240702090642730</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebSecurity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySecurityConfig</span> <span class="token punctuation">{</span>


    <span class="token comment">// ä½¿ç”¨åŸºäºæ•°æ®åº“çš„æ•°æ®è¿›è¡Œè®¤è¯</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">SysUserDetailService</span> userDetailService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// æ”¾è¡Œæ”¹èµ„æºï¼Œä¸ç”¨è®¤è¯å¯ä»¥ç›´æ¥è®¿é—®</span>
<span class="token comment">//                .requestMatchers(&quot;/test&quot;).permitAll()</span>
                <span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦è®¤è¯</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// å¼€å¯è¡¨å•ç™»å½•</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//æˆ‘ä»¬è‡ªå®šä¹‰çš„ç™»å½•é¡µé¢</span>
                <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// å¤„ç†ç™»å½•çš„url</span>
                <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/doLogin&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">usernameParameter</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">passwordParameter</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//                .successForwardUrl(&quot;/hello&quot;) è®¿é—®é»˜è®¤çš„æ¥å£</span>
                <span class="token comment">// ä¾ç„¶ä¼šè®¿é—®åˆ°åŸæ¥è®¿é—®çš„æ¥å£</span>
                <span class="token punctuation">.</span><span class="token function">defaultSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span>


<span class="token comment">//                .failureForwardUrl(&quot;/login.html&quot;)//ç™»å½•å¤±è´¥åçš„forwardè·³è½¬</span>
<span class="token comment">//                .failureUrl(&quot;/login.html&quot;) //redirectè·³è½¬</span>

                <span class="token comment">// è‡ªå®šä¹‰ç™»å½•å¤±è´¥å¤„ç†å™¨</span>
                <span class="token punctuation">.</span><span class="token function">failureHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyAuthenticationFailureHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                <span class="token comment">//è‡ªå®šä¹‰é€€å‡ºåŠŸèƒ½</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//å¼€å¯é€€å‡ºåŠŸèƒ½çš„å®šä¹‰</span>
                <span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//é€€å‡ºåŠŸèƒ½çš„URL</span>
                <span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/out&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//é€€å‡ºåæ˜¯å¦åˆ é™¤session</span>
                <span class="token punctuation">.</span><span class="token function">invalidateHttpSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token comment">//é»˜è®¤ä¸ºtrue æ¸…æ¥šå½“å‰è®¤è¯æ ‡è®°</span>
                <span class="token punctuation">.</span><span class="token function">clearAuthentication</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">logoutSuccessHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyLogoutSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_5-4-æµ‹è¯•" aria-hidden="true">#</a> 5.4 æµ‹è¯•</h3><p>æˆ‘ä»¬ä¾ç„¶ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è‡ªå®šä¹‰çš„ç™»å½•é¡µé¢ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨åŸå§‹SpringSecurityç»™æˆ‘ä»¬æä¾›çš„ç™»å½•é¡µé¢ï¼Œå¤§å®¶é€‰æ‹©ä¸€ä¸ªä½¿ç”¨å³å¯ã€‚</p>`,59),k={href:"http://localhost:8700/login.html",target:"_blank",rel:"noopener noreferrer"},r=a('<p>å¯ä»¥çœ‹åˆ°ç™»å½•æˆåŠŸï¼Œè¯´æ˜æˆ‘ä»¬æ•´ä¸ªè®¤è¯æµç¨‹å·²ç»å®Œæˆèµ°é€šäº†ï¼Œå¤§åŠŸå‘Šæˆ!!!</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202407020909728.png" alt="image-20240702090942673" tabindex="0" loading="lazy"><figcaption>image-20240702090942673</figcaption></figure><h2 id="_6-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_6-æ€»ç»“" aria-hidden="true">#</a> 6.æ€»ç»“</h2><p>ä»¥ä¸Šä¾¿æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ï¼Œæœ¬äººæ‰ç–å­¦æµ…ï¼Œæ–‡ç« æœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§ä½¬ä»¬æ‰¹è¯„æŒ‡æ­£ï¼æˆ‘æ˜¯<strong>Leo</strong>ï¼Œä¸€ä¸ªåœ¨äº’è”ç½‘è¡Œä¸šçš„å°ç™½ï¼Œç«‹å¿—æˆä¸ºæ›´å¥½çš„è‡ªå·±ã€‚</p><p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº<strong>Leo</strong>ï¼Œå¯ä»¥å…³æ³¨å…¬ä¼—å·-ç¨‹åºå‘˜Leoï¼Œåé¢æ–‡ç« ä¼šé¦–å…ˆåŒæ­¥è‡³å…¬ä¼—å·ã€‚</p><figure><img src="https://gaoziman.oss-cn-hangzhou.aliyuncs.com/2024/202406221047420.png" alt="å…¬ä¼—å·å°é¢" tabindex="0" loading="lazy"><figcaption>å…¬ä¼—å·å°é¢</figcaption></figure>',6);function d(v,m){const t=e("ExternalLinkIcon");return o(),c("div",null,[u,s("p",null,[n("å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—®ï¼š"),s("a",k,[n("http://localhost:8700/login.html"),i(t)]),n(" ï¼Œè¿™é‡Œä½¿ç”¨æˆ‘ä»¬æ•°æ®åº“çš„ç”¨æˆ·è¿›è¡Œç™»å½•ã€‚")]),r])}const y=p(l,[["render",d],["__file","database-based-authentication.html.vue"]]);export{y as default};
